<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> {{ metadata.app_name }} :: {{ title }} </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://unpkg.com/dropzone@5/dist/min/dropzone.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/dropzone@5/dist/min/dropzone.min.css" type="text/css" />
</head>

<body>
    <div class="container">

        <header>
            <div class="d-flex justify-content-between mt-5">
                <h1> {{ title}} </h1>
                {% if current_user.is_authenticated %}
                <div class="text-secondary text-end" style="display:flex;justify-content:flex-end;align-items:center;" >
                    Logged in as {{ current_user.username }}
                </div>
                {% endif %}
            </div>
    
            <nav class="d-flex justify-content-between" aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <!-- <li class="breadcrumb-item"><a href="#">Home</a></li>
                    <li class="breadcrumb-item"><a href="#">Library</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Data</li> -->
                    <li class="breadcrumb-item"><a href="/">Home</a></li>
                    {% for part in metadata.request.path.split('/') %}
                    {% if part %}
                    <li class="breadcrumb-item"> {{ part }} </li>
                    {% endif %}
                    {% endfor %}
                </ol>
    
                {% if current_user.is_authenticated %}
                <button type="button" class="btn btn-danger" onclick="window.location.href='{{ url_for("auth.logout")
                    }}'">Logout</button>
                {% endif %}
            </nav>    
        </header>

        <hr>

        <main>
            {% for category, message in get_flashed_messages(with_categories=true) %}
            {% if category == 'error' %}
            {% set category = 'danger' %}
            {% elif category == 'message' %}
            {% set category = 'info' %}
            {% elif category == 'warning' %}
            {% set category = 'warning' %}
            {% elif category == 'success' %}
            {% set category = 'success' %}
            {% else %}
            {% set category = 'primary' %}
            {% endif %}
            <div class="alert alert-{{ category }} d-flex justify-content-between" role="alert">
                <div>
                    {{ message }}
                </div>
                <button type="button" class="btn-close btn-close-sm" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}

            {% block content %} 
            {% endblock %}

            <div aria-live="polite" aria-atomic="true" class="position-relative">
                <!-- Position it: -->
                <!-- - `.toast-container` for spacing between toasts -->
                <!-- - `top-0` & `end-0` to position the toasts in the upper right corner -->
                <!-- - `.p-3` to prevent the toasts from sticking to the edge of the container  -->
                <!-- <div class="toast-container top-0 end-0 p-3"> -->
                <div class="toast-container position-fixed bottom-0 end-0 p-3">

                    <!-- Then put toasts within -->
                    {% for category, message in get_flashed_messages(with_categories=true) %}
                    <div class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                        <div class="toast-header">
                            <img src="{{ url_for('static', filename='favicon.ico') }}" class="rounded me-2" alt="..."
                                style="width: 20px; height: 20px;">
                            <strong class="me-auto">{{ category[0]|upper}}{{category[1:] }}</strong>
                            <small class="text-body-secondary" id="timestamp">just now</small>
                            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                        </div>
                        <div class="toast-body
                        ">
                            {{ message }}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </main>

    <footer class="footer mt-auto py-3 bg-light" style="flex-shrink: 0;">
        <div>
            <span class="text-muted">{{ metadata.app_name }} Â© 2024</span>
        </div>
    </footer>
</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
<script>
    function addToast(
        title = 'Default Title',
        message = 'Default Message'
    ) {
        let toast = document.createElement('div');
        toast.classList.add('toast');
        toast.setAttribute('role', 'alert');
        toast.setAttribute('aria-live', 'assertive');
        toast.setAttribute('aria-atomic', 'true');

        let toastHeader = document.createElement('div');
        toastHeader.classList.add('toast-header');

        let toastImg = document.createElement('img');
        toastImg.src = '{{ url_for("static", filename="favicon.ico") }}';
        toastImg.classList.add('rounded', 'me-2');
        toastImg.alt = '...';
        toastImg.style.width = '20px';
        toastImg.style.height = '20px';

        let toastStrong = document.createElement('strong');
        toastStrong.classList.add('me-auto');
        toastStrong.innerText = title;

        let toastSmall = document.createElement('small');
        toastSmall.classList.add('text-body-secondary');
        toastSmall.innerText = new Date().toLocaleTimeString();
        toastSmall.id = 'timestamp';

        let toastButton = document.createElement('button');
        toastButton.type = 'button';
        toastButton.classList.add('btn-close');
        toastButton.setAttribute('data-bs-dismiss', 'toast');
        toastButton.setAttribute('aria-label', 'Close');

        let toastBody = document.createElement('div');
        toastBody.classList.add('toast-body');
        toastBody.innerText = message;

        toastHeader.appendChild(toastImg);
        toastHeader.appendChild(toastStrong);
        toastHeader.appendChild(toastSmall);
        toastHeader.appendChild(toastButton);

        toast.appendChild(toastHeader);
        toast.appendChild(toastBody);

        let toastContainer = document.querySelector('.toast-container');
        toastContainer.appendChild(toast);

        let bsToast = new bootstrap.Toast(toast, { autohide: false });
        bsToast.show();
    }

    window.onload = (event) => {

        // Select all timestamp elements
        let timestamps = document.querySelectorAll('#timestamp');
        // Replace each timestamp with the time elapsed since the page was loaded
        timestamps.forEach((timestamp) => {
            timestamp.innerText = new Date().toLocaleTimeString();
        });

        // Select all toasts
        let toasts = document.querySelectorAll('.toast');
        // Create a toast for each toast element
        toasts.forEach((toast) => {
            let bsToast = new bootstrap.Toast(toast, { autohide: false });
            bsToast.show();
        });

        // addToast('Welcome', 'This is a simple file upload portal.');
    }
</script>


{% block scripts %}
{% endblock %}

</html>